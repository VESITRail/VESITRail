model ConcessionApplication {
  id      String @id @default(uuid())
  shortId Int    @unique @default(autoincrement())

  pageOffset      Int?
  applicationType ConcessionApplicationType
  status          ConcessionApplicationStatus

  rejectionReason String?
  submissionCount Int     @default(1)

  reviewedAt DateTime?
  updatedAt  DateTime  @updatedAt
  createdAt  DateTime  @default(now())

  stationId          String
  studentId          String
  concessionClassId  String
  concessionPeriodId String

  reviewedById          String?
  concessionBookletId   String?
  previousApplicationId String? @unique

  station          Station          @relation(fields: [stationId], references: [id])
  student          Student          @relation(fields: [studentId], references: [userId])
  concessionClass  ConcessionClass  @relation(fields: [concessionClassId], references: [id])
  concessionPeriod ConcessionPeriod @relation(fields: [concessionPeriodId], references: [id])

  renewalApplication  ConcessionApplication? @relation("RenewalChain")
  reviewedBy          Admin?                 @relation(fields: [reviewedById], references: [userId])
  concessionBooklet   ConcessionBooklet?     @relation(fields: [concessionBookletId], references: [id])
  previousApplication ConcessionApplication? @relation("RenewalChain", fields: [previousApplicationId], references: [id])
}

model ConcessionBooklet {
  id String @id @default(uuid())

  totalPages    Int @default(50)
  bookletNumber Int @unique @default(autoincrement())

  serialStartNumber String
  serialEndNumber   String
  status            ConcessionBookletStatus @default(Available)

  updatedAt DateTime @updatedAt
  createdAt DateTime @default(now())

  applications ConcessionApplication[]
}

model ConcessionPeriod {
  id String @id @default(uuid())

  duration Int    @unique
  name     String @unique

  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  applications      ConcessionApplication[]
  studentsPreferred Student[]               @relation("StudentPreferredPeriod")
}

model ConcessionClass {
  id String @id @default(uuid())

  code String @unique
  name String @unique

  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  applications      ConcessionApplication[]
  studentsPreferred Student[]               @relation("StudentPreferredClass")
}

model Station {
  id String @id @default(uuid())

  code String @unique
  name String @unique

  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())

  students     Student[]
  applications ConcessionApplication[]

  newStationChange     AddressChange[] @relation("NewStation")
  currentStationChange AddressChange[] @relation("CurrentStation")
}
