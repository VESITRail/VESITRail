model ConcessionApplication {
  id              String                      @id @default(uuid())
  pageNumber      Int?
  applicationType ConcessionApplicationType
  status          ConcessionApplicationStatus

  approvedAt DateTime?
  updatedAt  DateTime  @updatedAt
  createdAt  DateTime  @default(now())
  isDeleted  Boolean   @default(false)

  stationId             String
  studentUserId         String
  concessionClassId     String
  concessionPeriodId    String
  approvedByAdminId     String?
  concessionBookletId   String?
  previousApplicationId String? @unique

  renewalApplication  ConcessionApplication? @relation("RenewalChain")
  station             Station                @relation(fields: [stationId], references: [id])
  student             Student                @relation(fields: [studentUserId], references: [userId])
  concessionClass     ConcessionClass        @relation(fields: [concessionClassId], references: [id])
  concessionPeriod    ConcessionPeriod       @relation(fields: [concessionPeriodId], references: [id])
  concessionBooklet   ConcessionBooklet?     @relation(fields: [concessionBookletId], references: [id])
  approvedBy          Admin?                 @relation(fields: [approvedByAdminId], references: [userId])
  previousApplication ConcessionApplication? @relation("RenewalChain", fields: [previousApplicationId], references: [id])
}

model ConcessionBooklet {
  id                String                  @id @default(uuid())
  usedPages         Int
  totalPages        Int
  bookletNumber     Int
  serialEndNumber   String
  serialStartNumber String
  status            ConcessionBookletStatus

  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())

  applications ConcessionApplication[]
}

model ConcessionPeriod {
  id       String @id @default(uuid())
  duration Int
  code     String

  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())

  applications      ConcessionApplication[]
  studentsPreferred Student[]               @relation("StudentPreferredPeriod")
}

model ConcessionClass {
  id   String @id @default(uuid())
  code String
  name String

  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())

  applications      ConcessionApplication[]
  studentsPreferred Student[]               @relation("StudentPreferredClass")
}

model Station {
  id   String @id @default(uuid())
  code String
  name String

  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)
  isDeleted Boolean  @default(false)
  createdAt DateTime @default(now())

  students     Student[]
  applications ConcessionApplication[]
}
